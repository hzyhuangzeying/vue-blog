import{_ as O,k as W,u as X,r as h,i as Z,o as Q,j as ee,a as l,c as i,b as r,d as o,l as A,t as u,e as n,w as d,h as m,F as R,f as T,g as te}from"./index-DoAYnoBG.js";import{u as se}from"./articles-aqgRK6Hw.js";import{f as ae,z as oe}from"./zh-CN-ZPh2jKaf.js";const ne={class:"search-page"},le={class:"search-container"},re={class:"search-header"},ce={class:"search-info"},ie={key:0},ue={key:1},de={class:"search-filters"},_e={key:0,class:"loading-container"},ve={key:1,class:"empty-container"},he={key:2,class:"search-results"},me=["onClick"],pe={class:"result-cover"},ge=["src","alt"],fe={class:"result-content"},ke={class:"result-title"},we=["innerHTML"],ye={class:"result-summary"},Ce=["innerHTML"],be={class:"result-meta"},Se={class:"author-info"},De={class:"author-name"},ze={class:"article-stats"},Ve={class:"stat-item"},Le={class:"stat-item"},Ae={class:"stat-item"},Re={class:"article-tags"},Te={class:"result-time"},xe={class:"pagination-container"},Fe={__name:"Search",setup(Me){const S=W(),x=X(),F=se(),c=h(""),_=h([]),f=h(!1),k=h("relevance"),p=h("all"),g=h(1),w=h(10),M=Z(()=>_.value.length);Q(()=>{const t=S.query.q;t&&(c.value=t,D())}),ee(()=>S.query.q,t=>{t&&(c.value=t,D())});const D=async()=>{if(c.value.trim()){f.value=!0;try{const t=await F.searchArticles(c.value);t.success&&(_.value=t.data,y())}finally{f.value=!1}}},y=()=>{let t=[..._.value];if(p.value!=="all"){const e=new Date,s=new Date;switch(p.value){case"week":s.setDate(e.getDate()-7);break;case"month":s.setMonth(e.getMonth()-1);break;case"year":s.setFullYear(e.getFullYear()-1);break}t=t.filter(v=>new Date(v.createdAt)>=s)}switch(k.value){case"views":t.sort((e,s)=>s.views-e.views);break;case"likes":t.sort((e,s)=>s.likes-e.likes);break;case"latest":t.sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt));break;case"relevance":default:t.sort((e,s)=>{const v=z(e);return z(s)-v});break}_.value=t},z=t=>{const e=c.value.toLowerCase();let s=0;return t.title.toLowerCase().includes(e)&&(s+=10),t.summary.toLowerCase().includes(e)&&(s+=5),t.tags.some(v=>v.toLowerCase().includes(e))&&(s+=3),t.category.toLowerCase().includes(e)&&(s+=2),s},V=t=>{if(!c.value)return t;const e=c.value,s=new RegExp(`(${e})`,"gi");return t.replace(s,"<mark>$1</mark>")},N=()=>{y()},q=()=>{y()},B=t=>{w.value=t,g.value=1},$=t=>{g.value=t},H=t=>{x.push({name:"ArticleDetail",params:{id:t.id}})},U=t=>{const e=new Date(t);return ae(e,{addSuffix:!0,locale:oe})};return(t,e)=>{const s=l("el-option"),v=l("el-select"),L=l("el-skeleton"),j=l("el-button"),E=l("el-empty"),K=l("el-avatar"),P=l("View"),C=l("el-icon"),Y=l("Star"),I=l("ChatDotRound"),G=l("el-tag"),J=l("el-pagination");return r(),i("div",ne,[o("div",le,[o("div",re,[e[5]||(e[5]=o("h1",{class:"page-title"},"搜索结果",-1)),o("div",ce,[c.value?(r(),i("span",ie,"关键词："+u(c.value),1)):A("",!0),_.value.length>0?(r(),i("span",ue,"找到 "+u(_.value.length)+" 个结果",1)):A("",!0)])]),o("div",de,[n(v,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),placeholder:"排序方式",onChange:N},{default:d(()=>[n(s,{label:"相关度",value:"relevance"}),n(s,{label:"最新发布",value:"latest"}),n(s,{label:"最多阅读",value:"views"}),n(s,{label:"最多点赞",value:"likes"})]),_:1},8,["modelValue"]),n(v,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value=a),placeholder:"时间范围",onChange:q},{default:d(()=>[n(s,{label:"全部时间",value:"all"}),n(s,{label:"最近一周",value:"week"}),n(s,{label:"最近一月",value:"month"}),n(s,{label:"最近一年",value:"year"})]),_:1},8,["modelValue"])]),f.value?(r(),i("div",_e,[n(L,{rows:5,animated:""})])):_.value.length===0?(r(),i("div",ve,[n(E,{description:"没有找到相关文章"},{default:d(()=>[n(j,{type:"primary",onClick:e[2]||(e[2]=a=>t.$router.push("/articles"))},{default:d(()=>[...e[6]||(e[6]=[m(" 浏览所有文章 ",-1)])]),_:1})]),_:1})])):(r(),i("div",he,[(r(!0),i(R,null,T(_.value,a=>(r(),i("div",{key:a.id,class:"result-item",onClick:b=>H(a)},[o("div",pe,[o("img",{src:a.cover,alt:a.title},null,8,ge)]),o("div",fe,[o("h3",ke,[o("span",{innerHTML:V(a.title)},null,8,we)]),o("p",ye,[o("span",{innerHTML:V(a.summary)},null,8,Ce)]),o("div",be,[o("div",Se,[n(K,{src:a.author.avatar,size:20},{default:d(()=>[m(u(a.author.nickname.charAt(0)),1)]),_:2},1032,["src"]),o("span",De,u(a.author.nickname),1)]),o("div",ze,[o("span",Ve,[n(C,null,{default:d(()=>[n(P)]),_:1}),m(" "+u(a.views),1)]),o("span",Le,[n(C,null,{default:d(()=>[n(Y)]),_:1}),m(" "+u(a.likes),1)]),o("span",Ae,[n(C,null,{default:d(()=>[n(I)]),_:1}),m(" "+u(a.comments),1)])]),o("div",Re,[(r(!0),i(R,null,T(a.tags,b=>(r(),te(G,{key:b,size:"small",class:"tag"},{default:d(()=>[m(u(b),1)]),_:2},1024))),128))])]),o("div",Te,u(U(a.createdAt)),1)])],8,me))),128))])),o("div",xe,[n(J,{"current-page":g.value,"onUpdate:currentPage":e[3]||(e[3]=a=>g.value=a),"page-size":w.value,"onUpdate:pageSize":e[4]||(e[4]=a=>w.value=a),"page-sizes":[10,20,50],total:M.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:$},null,8,["current-page","page-size","total"])])])])}}},$e=O(Fe,[["__scopeId","data-v-d3afc8a9"]]);export{$e as default};
