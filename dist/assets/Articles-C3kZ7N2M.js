import{_ as I,u as N,r as u,i as A,o as q,j as E,a as p,c as d,b as n,d as g,e as o,w as b,F as w,f as z,g as V}from"./index-DoAYnoBG.js";import{u as L}from"./articles-aqgRK6Hw.js";import{A as M}from"./ArticleCard-BnejBbSa.js";import"./zh-CN-ZPh2jKaf.js";const $={class:"articles-page"},G={class:"page-header"},H={class:"page-actions"},J={class:"articles-container"},K={key:0,class:"loading-container"},O={key:1,class:"empty-container"},T={key:2,class:"articles-list"},W={class:"pagination-container"},X={__name:"Articles",setup(Y){const k=N(),C=L(),m=u([]),_=u([]),h=u(!1),r=u(""),f=u("latest"),i=u(1),v=u(12),y=A(()=>{let e=[...m.value];if(r.value){const l=_.value.find(s=>s.id===r.value);l&&(e=e.filter(s=>s.category===l.name))}switch(f.value){case"views":e.sort((l,s)=>s.views-l.views);break;case"likes":e.sort((l,s)=>s.likes-l.likes);break;case"latest":default:e.sort((l,s)=>new Date(s.createdAt)-new Date(l.createdAt));break}const t=(i.value-1)*v.value,c=t+v.value;return e.slice(t,c)}),S=A(()=>{if(r.value){const e=_.value.find(t=>t.id===r.value);if(e)return m.value.filter(t=>t.category===e.name).length}return m.value.length});q(async()=>{await x()});const x=async()=>{h.value=!0;try{const[e,t]=await Promise.all([C.fetchArticles(),C.fetchCategories()]);e.success&&(m.value=e.data),t.success&&(_.value=t.data)}finally{h.value=!1}},B=()=>{i.value=1},D=()=>{i.value=1},R=e=>{v.value=e,i.value=1},U=e=>{i.value=e},P=e=>{k.push({name:"ArticleDetail",params:{id:e.id}})};return E(()=>k.currentRoute.value.query,e=>{e.category&&(r.value=parseInt(e.category)),e.sort&&(f.value=e.sort)},{immediate:!0}),(e,t)=>{const c=p("el-option"),l=p("el-select"),s=p("el-skeleton"),j=p("el-empty"),F=p("el-pagination");return n(),d("div",$,[g("div",G,[t[4]||(t[4]=g("h1",{class:"page-title"},"文章列表",-1)),g("div",H,[o(l,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),placeholder:"选择分类",onChange:B},{default:b(()=>[o(c,{label:"全部分类",value:""}),(n(!0),d(w,null,z(_.value,a=>(n(),V(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(l,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),placeholder:"排序方式",onChange:D},{default:b(()=>[o(c,{label:"最新发布",value:"latest"}),o(c,{label:"最多阅读",value:"views"}),o(c,{label:"最多点赞",value:"likes"})]),_:1},8,["modelValue"])])]),g("div",J,[h.value?(n(),d("div",K,[o(s,{rows:5,animated:""})])):y.value.length===0?(n(),d("div",O,[o(j,{description:"暂无文章"})])):(n(),d("div",T,[(n(!0),d(w,null,z(y.value,a=>(n(),V(M,{key:a.id,article:a,onClick:Z=>P(a)},null,8,["article","onClick"]))),128))]))]),g("div",W,[o(F,{"current-page":i.value,"onUpdate:currentPage":t[2]||(t[2]=a=>i.value=a),"page-size":v.value,"onUpdate:pageSize":t[3]||(t[3]=a=>v.value=a),"page-sizes":[6,12,24,48],total:S.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:R,onCurrentChange:U},null,8,["current-page","page-size","total"])])])}}},le=I(X,[["__scopeId","data-v-5b9dfaf5"]]);export{le as default};
