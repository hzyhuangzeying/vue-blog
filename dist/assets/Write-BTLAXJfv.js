import{_ as O,u as P,r as b,p as W,i as j,o as z,a as i,c as v,b as d,d as n,e as o,w as s,h as u,F as $,f as V,g as w,t as C,E as p,v as A}from"./index-DoAYnoBG.js";import{u as J}from"./articles-aqgRK6Hw.js";const G={class:"write-page"},K={class:"write-container"},Q={class:"write-header"},X={class:"header-actions"},Y={class:"write-content"},Z={class:"editor-section"},h={class:"article-info"},ee=["src"],te={class:"editor-container"},le={class:"editor-toolbar"},oe={class:"editor-content"},se={class:"preview-section"},ne={class:"preview-header"},ae={key:0,class:"preview-content"},re={class:"preview-article"},ie={class:"preview-title"},de={class:"preview-meta"},ue={class:"preview-category"},ce={class:"preview-tags"},me=["innerHTML"],pe={key:1,class:"editor-content"},fe={__name:"Write",setup(ve){const U=P(),S=J(),k=b(!1),x=b([]),M=b(["Vue3","React","Node.js","TypeScript","JavaScript","CSS","HTML","Webpack","前端","后端"]),l=W({title:"",summary:"",category:"",tags:[],cover:"",content:""}),T=j(()=>l.content?l.content.replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/\*\*(.*)\*\*/gim,"<strong>$1</strong>").replace(/\*(.*)\*/gim,"<em>$1</em>").replace(/`(.*)`/gim,"<code>$1</code>").replace(/```([\s\S]*?)```/gim,"<pre><code>$1</code></pre>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/^> (.*$)/gim,"<blockquote>$1</blockquote>").replace(/\[([^\]]+)\]\(([^)]+)\)/gim,'<a href="$2">$1</a>').replace(/\n/gim,"<br>"):"");z(async()=>{const r=await S.fetchCategories();r.success&&(x.value=r.data)});const c=(r,e)=>{const a=document.querySelector(".markdown-editor textarea");if(a){const m=a.selectionStart,f=a.selectionEnd,g=l.content.substring(m,f),_=r+g+e;l.content=l.content.substring(0,m)+_+l.content.substring(f),setTimeout(()=>{a.focus(),a.setSelectionRange(m+r.length,m+r.length+g.length)},0)}},B=r=>{const e=r.type.startsWith("image/"),a=r.size/1024/1024<5;return e?a?(l.cover=URL.createObjectURL(r),!1):(p.error("图片大小不能超过 5MB!"),!1):(p.error("只能上传图片文件!"),!1)},D=()=>l.title.trim()?l.category?l.content.trim()?!0:(p.warning("请输入文章内容"),!1):(p.warning("请选择文章分类"),!1):(p.warning("请输入文章标题"),!1),L=()=>{if(!l.title.trim()&&!l.content.trim()){p.warning("请至少输入标题或内容");return}localStorage.setItem("articleDraft",JSON.stringify(l)),p.success("草稿保存成功")},H=async()=>{if(D())try{await A.confirm("确定要发布这篇文章吗？","确认发布",{type:"info"});const r=await S.createArticle(l);r.success?(p.success("文章发布成功！"),localStorage.removeItem("articleDraft"),U.push({name:"ArticleDetail",params:{id:r.data.id}})):p.error(r.message||"发布失败")}catch{}};return z(()=>{const r=localStorage.getItem("articleDraft");if(r)try{const e=JSON.parse(r);Object.assign(l,e)}catch(e){console.error("Failed to load draft:",e)}}),(r,e)=>{const a=i("el-button"),m=i("el-input"),f=i("el-form-item"),g=i("el-option"),_=i("el-select"),I=i("Plus"),N=i("el-icon"),q=i("el-upload"),E=i("el-form"),y=i("el-button-group"),F=i("el-switch"),R=i("el-tag");return d(),v("div",G,[n("div",K,[n("div",Q,[e[19]||(e[19]=n("h1",{class:"page-title"},"写文章",-1)),n("div",X,[o(a,{onClick:L},{default:s(()=>[...e[17]||(e[17]=[u("保存草稿",-1)])]),_:1}),o(a,{type:"primary",onClick:H},{default:s(()=>[...e[18]||(e[18]=[u("发布文章",-1)])]),_:1})])]),n("div",Y,[n("div",Z,[n("div",h,[o(E,{model:l,"label-width":"80px"},{default:s(()=>[o(f,{label:"文章标题",required:""},{default:s(()=>[o(m,{modelValue:l.title,"onUpdate:modelValue":e[0]||(e[0]=t=>l.title=t),placeholder:"请输入文章标题",size:"large",class:"title-input"},null,8,["modelValue"])]),_:1}),o(f,{label:"文章摘要"},{default:s(()=>[o(m,{modelValue:l.summary,"onUpdate:modelValue":e[1]||(e[1]=t=>l.summary=t),type:"textarea",rows:3,placeholder:"请输入文章摘要（可选）"},null,8,["modelValue"])]),_:1}),o(f,{label:"文章分类",required:""},{default:s(()=>[o(_,{modelValue:l.category,"onUpdate:modelValue":e[2]||(e[2]=t=>l.category=t),placeholder:"请选择分类"},{default:s(()=>[(d(!0),v($,null,V(x.value,t=>(d(),w(g,{key:t.id,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"文章标签"},{default:s(()=>[o(_,{modelValue:l.tags,"onUpdate:modelValue":e[3]||(e[3]=t=>l.tags=t),multiple:"",filterable:"","allow-create":"",placeholder:"请选择或输入标签"},{default:s(()=>[(d(!0),v($,null,V(M.value,t=>(d(),w(g,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"封面图片"},{default:s(()=>[o(q,{class:"cover-uploader",action:"#","show-file-list":!1,"before-upload":B},{default:s(()=>[l.cover?(d(),v("img",{key:0,src:l.cover,class:"cover-image"},null,8,ee)):(d(),w(N,{key:1,class:"cover-uploader-icon"},{default:s(()=>[o(I)]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),n("div",te,[n("div",le,[o(y,null,{default:s(()=>[o(a,{size:"small",onClick:e[4]||(e[4]=t=>c("**","**"))},{default:s(()=>[...e[20]||(e[20]=[n("strong",null,"B",-1)])]),_:1}),o(a,{size:"small",onClick:e[5]||(e[5]=t=>c("*","*"))},{default:s(()=>[...e[21]||(e[21]=[n("em",null,"I",-1)])]),_:1}),o(a,{size:"small",onClick:e[6]||(e[6]=t=>c("`","`"))},{default:s(()=>[...e[22]||(e[22]=[u(" Code ",-1)])]),_:1}),o(a,{size:"small",onClick:e[7]||(e[7]=t=>c("```\n","\n```"))},{default:s(()=>[...e[23]||(e[23]=[u(" Code Block ",-1)])]),_:1})]),_:1}),o(y,null,{default:s(()=>[o(a,{size:"small",onClick:e[8]||(e[8]=t=>c("# ",""))},{default:s(()=>[...e[24]||(e[24]=[u(" H1 ",-1)])]),_:1}),o(a,{size:"small",onClick:e[9]||(e[9]=t=>c("## ",""))},{default:s(()=>[...e[25]||(e[25]=[u(" H2 ",-1)])]),_:1}),o(a,{size:"small",onClick:e[10]||(e[10]=t=>c("### ",""))},{default:s(()=>[...e[26]||(e[26]=[u(" H3 ",-1)])]),_:1})]),_:1}),o(y,null,{default:s(()=>[o(a,{size:"small",onClick:e[11]||(e[11]=t=>c("- ",""))},{default:s(()=>[...e[27]||(e[27]=[u(" 列表 ",-1)])]),_:1}),o(a,{size:"small",onClick:e[12]||(e[12]=t=>c("> ",""))},{default:s(()=>[...e[28]||(e[28]=[u(" 引用 ",-1)])]),_:1}),o(a,{size:"small",onClick:e[13]||(e[13]=t=>c("[链接文字](",")"))},{default:s(()=>[...e[29]||(e[29]=[u(" 链接 ",-1)])]),_:1})]),_:1})]),n("div",oe,[o(m,{modelValue:l.content,"onUpdate:modelValue":e[14]||(e[14]=t=>l.content=t),type:"textarea",rows:20,placeholder:"开始写作...",class:"markdown-editor"},null,8,["modelValue"])])])]),n("div",se,[n("div",ne,[e[30]||(e[30]=n("h3",null,"预览",-1)),o(F,{modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=t=>k.value=t),"active-text":"预览模式","inactive-text":"编辑模式"},null,8,["modelValue"])]),k.value?(d(),v("div",ae,[n("div",re,[n("h1",ie,C(l.title||"文章标题"),1),n("div",de,[n("span",ue,C(l.category||"分类"),1),n("span",ce,[(d(!0),v($,null,V(l.tags,t=>(d(),w(R,{key:t,size:"small",class:"preview-tag"},{default:s(()=>[u(C(t),1)]),_:2},1024))),128))])]),n("div",{class:"preview-body",innerHTML:T.value},null,8,me)])])):(d(),v("div",pe,[o(m,{modelValue:l.content,"onUpdate:modelValue":e[16]||(e[16]=t=>l.content=t),type:"textarea",rows:20,placeholder:"开始写作...",class:"markdown-editor"},null,8,["modelValue"])]))])])])])}}},we=O(fe,[["__scopeId","data-v-ce4847ba"]]);export{we as default};
