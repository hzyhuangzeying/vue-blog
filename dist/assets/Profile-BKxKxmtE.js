import{_ as pt,u as ft,m as vt,r as h,p as j,o as yt,a as n,c as _,b as m,d as l,e,w as o,h as d,t as i,q as b,F as J,f as O,s as H,g as kt,v as K,E as f}from"./index-DoAYnoBG.js";import{u as bt}from"./articles-aqgRK6Hw.js";import{f as wt,z as ht}from"./zh-CN-ZPh2jKaf.js";const Vt={class:"profile-page"},gt={class:"profile-container"},Ct={class:"profile-card"},At={class:"profile-header"},Nt={class:"avatar-section"},xt={class:"user-info"},St={class:"username"},Ut={class:"user-bio"},$t={class:"user-stats"},Dt={class:"stat-item"},Et={class:"stat-number"},Bt={class:"stat-item"},Pt={class:"stat-number"},zt={class:"stat-item"},Mt={class:"stat-number"},Ft={class:"profile-actions"},Tt={class:"content-tabs"},Lt={class:"articles-section"},Rt={class:"section-header"},It={key:0,class:"empty-state"},qt={key:1,class:"articles-list"},Gt=["onClick"],Wt=["src","alt"],jt={class:"article-content"},Jt={class:"article-title"},Ot={class:"article-summary"},Ht={class:"article-meta"},Kt={class:"article-category"},Qt={class:"article-time"},Xt={class:"article-stats"},Yt={class:"article-actions"},Zt={class:"favorites-section"},te={key:0,class:"empty-state"},ee={key:1,class:"articles-list"},se=["onClick"],le=["src","alt"],oe={class:"article-content"},ae={class:"article-title"},ne={class:"article-summary"},ie={class:"article-meta"},de={class:"article-author"},re={class:"article-time"},ue={class:"settings-section"},ce={class:"avatar-upload"},me=["src"],_e={__name:"Profile",setup(pe){const N=ft(),r=vt(),E=bt(),x=h("articles"),V=h(!1),g=h(!1),A=h(""),C=h([]),S=h([]),c=j({nickname:"",bio:"",email:""}),v=j({emailNotification:!0,commentNotification:!0,followNotification:!1});yt(async()=>{await X(),await Y(),Q()});const Q=()=>{r.user&&(c.nickname=r.user.nickname,c.bio=r.user.bio||"",c.email=r.user.email)},X=async()=>{const a=await E.fetchArticles();a.success&&(C.value=a.data.filter(t=>{var p;return t.author.id===((p=r.user)==null?void 0:p.id)}))},Y=async()=>{const a=await E.fetchArticles();a.success&&(S.value=a.data.slice(0,5))},Z=a=>{x.value=a},B=a=>{N.push({name:"ArticleDetail",params:{id:a.id}})},tt=a=>{N.push({name:"Write",query:{id:a.id}})},et=async a=>{try{await K.confirm("确定要删除这篇文章吗？","确认删除",{type:"warning"});const t=C.value.findIndex(p=>p.id===a.id);t>-1&&(C.value.splice(t,1),f.success("删除成功"))}catch{}},st=async()=>{const a=await r.updateProfile(c);a.success?(f.success("资料更新成功"),V.value=!1):f.error(a.message||"更新失败")},lt=a=>{const t=a.type.startsWith("image/"),p=a.size/1024/1024<2;return t?p?(A.value=URL.createObjectURL(a),!1):(f.error("图片大小不能超过 2MB!"),!1):(f.error("只能上传图片文件!"),!1)},ot=()=>{A.value&&(f.success("头像更新成功"),g.value=!1)},at=()=>{f.success("设置保存成功")},nt=async()=>{try{await K.confirm("确定要退出登录吗？","确认退出",{type:"warning"}),r.logout(),f.success("已退出登录"),N.push("/home")}catch{}},P=a=>{const t=new Date(a);return wt(t,{addSuffix:!0,locale:ht})};return(a,t)=>{var L,R,I,q,G,W;const p=n("el-avatar"),u=n("el-button"),z=n("Edit"),y=n("el-icon"),it=n("SwitchButton"),M=n("el-empty"),dt=n("View"),rt=n("Star"),ut=n("ChatDotRound"),U=n("el-tab-pane"),$=n("el-switch"),k=n("el-form-item"),F=n("el-form"),ct=n("el-tabs"),D=n("el-input"),T=n("el-dialog"),mt=n("Plus"),_t=n("el-upload");return m(),_("div",Vt,[l("div",gt,[l("div",Ct,[l("div",At,[l("div",Nt,[e(p,{src:(L=b(r).user)==null?void 0:L.avatar,size:80},{default:o(()=>{var s,w;return[d(i((w=(s=b(r).user)==null?void 0:s.nickname)==null?void 0:w.charAt(0)),1)]}),_:1},8,["src"]),e(u,{type:"primary",size:"small",onClick:t[0]||(t[0]=s=>g.value=!0)},{default:o(()=>[...t[15]||(t[15]=[d(" 更换头像 ",-1)])]),_:1})]),l("div",xt,[l("h1",St,i((R=b(r).user)==null?void 0:R.nickname),1),l("p",Ut,i(((I=b(r).user)==null?void 0:I.bio)||"这个人很懒，什么都没有写..."),1),l("div",$t,[l("div",Dt,[l("span",Et,i(((q=b(r).user)==null?void 0:q.followers)||0),1),t[16]||(t[16]=l("span",{class:"stat-label"},"关注者",-1))]),l("div",Bt,[l("span",Pt,i(((G=b(r).user)==null?void 0:G.following)||0),1),t[17]||(t[17]=l("span",{class:"stat-label"},"关注中",-1))]),l("div",zt,[l("span",Mt,i(((W=b(r).user)==null?void 0:W.articles)||0),1),t[18]||(t[18]=l("span",{class:"stat-label"},"文章",-1))])])])]),l("div",Ft,[e(u,{type:"primary",onClick:t[1]||(t[1]=s=>V.value=!0)},{default:o(()=>[e(y,null,{default:o(()=>[e(z)]),_:1}),t[19]||(t[19]=d(" 编辑资料 ",-1))]),_:1}),e(u,{onClick:nt},{default:o(()=>[e(y,null,{default:o(()=>[e(it)]),_:1}),t[20]||(t[20]=d(" 退出登录 ",-1))]),_:1})])]),l("div",Tt,[e(ct,{modelValue:x.value,"onUpdate:modelValue":t[7]||(t[7]=s=>x.value=s),onTabChange:Z},{default:o(()=>[e(U,{label:"我的文章",name:"articles"},{default:o(()=>[l("div",Lt,[l("div",Rt,[t[22]||(t[22]=l("h3",null,"我的文章",-1)),e(u,{type:"primary",onClick:t[2]||(t[2]=s=>a.$router.push("/write"))},{default:o(()=>[e(y,null,{default:o(()=>[e(z)]),_:1}),t[21]||(t[21]=d(" 写文章 ",-1))]),_:1})]),C.value.length===0?(m(),_("div",It,[e(M,{description:"还没有发布任何文章"},{default:o(()=>[e(u,{type:"primary",onClick:t[3]||(t[3]=s=>a.$router.push("/write"))},{default:o(()=>[...t[23]||(t[23]=[d(" 开始写作 ",-1)])]),_:1})]),_:1})])):(m(),_("div",qt,[(m(!0),_(J,null,O(C.value,s=>(m(),_("div",{key:s.id,class:"article-item",onClick:w=>B(s)},[l("img",{src:s.cover,alt:s.title,class:"article-cover"},null,8,Wt),l("div",jt,[l("h4",Jt,i(s.title),1),l("p",Ot,i(s.summary),1),l("div",Ht,[l("span",Kt,i(s.category),1),l("span",Qt,i(P(s.createdAt)),1),l("div",Xt,[l("span",null,[e(y,null,{default:o(()=>[e(dt)]),_:1}),d(" "+i(s.views),1)]),l("span",null,[e(y,null,{default:o(()=>[e(rt)]),_:1}),d(" "+i(s.likes),1)]),l("span",null,[e(y,null,{default:o(()=>[e(ut)]),_:1}),d(" "+i(s.comments),1)])])])]),l("div",Yt,[e(u,{type:"text",size:"small",onClick:H(w=>tt(s),["stop"])},{default:o(()=>[...t[24]||(t[24]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(u,{type:"text",size:"small",onClick:H(w=>et(s),["stop"])},{default:o(()=>[...t[25]||(t[25]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])])],8,Gt))),128))]))])]),_:1}),e(U,{label:"收藏",name:"favorites"},{default:o(()=>[l("div",Zt,[S.value.length===0?(m(),_("div",te,[e(M,{description:"还没有收藏任何文章"})])):(m(),_("div",ee,[(m(!0),_(J,null,O(S.value,s=>(m(),_("div",{key:s.id,class:"article-item",onClick:w=>B(s)},[l("img",{src:s.cover,alt:s.title,class:"article-cover"},null,8,le),l("div",oe,[l("h4",ae,i(s.title),1),l("p",ne,i(s.summary),1),l("div",ie,[l("span",de,i(s.author.nickname),1),l("span",re,i(P(s.createdAt)),1)])])],8,se))),128))]))])]),_:1}),e(U,{label:"设置",name:"settings"},{default:o(()=>[l("div",ue,[e(F,{model:v,"label-width":"120px"},{default:o(()=>[e(k,{label:"邮箱通知"},{default:o(()=>[e($,{modelValue:v.emailNotification,"onUpdate:modelValue":t[4]||(t[4]=s=>v.emailNotification=s)},null,8,["modelValue"])]),_:1}),e(k,{label:"评论通知"},{default:o(()=>[e($,{modelValue:v.commentNotification,"onUpdate:modelValue":t[5]||(t[5]=s=>v.commentNotification=s)},null,8,["modelValue"])]),_:1}),e(k,{label:"关注通知"},{default:o(()=>[e($,{modelValue:v.followNotification,"onUpdate:modelValue":t[6]||(t[6]=s=>v.followNotification=s)},null,8,["modelValue"])]),_:1}),e(k,null,{default:o(()=>[e(u,{type:"primary",onClick:at},{default:o(()=>[...t[26]||(t[26]=[d(" 保存设置 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])])]),e(T,{modelValue:V.value,"onUpdate:modelValue":t[12]||(t[12]=s=>V.value=s),title:"编辑资料",width:"500px"},{footer:o(()=>[e(u,{onClick:t[11]||(t[11]=s=>V.value=!1)},{default:o(()=>[...t[27]||(t[27]=[d("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:st},{default:o(()=>[...t[28]||(t[28]=[d("保存",-1)])]),_:1})]),default:o(()=>[e(F,{model:c,"label-width":"80px"},{default:o(()=>[e(k,{label:"昵称"},{default:o(()=>[e(D,{modelValue:c.nickname,"onUpdate:modelValue":t[8]||(t[8]=s=>c.nickname=s)},null,8,["modelValue"])]),_:1}),e(k,{label:"个人简介"},{default:o(()=>[e(D,{modelValue:c.bio,"onUpdate:modelValue":t[9]||(t[9]=s=>c.bio=s),type:"textarea",rows:4,placeholder:"介绍一下自己..."},null,8,["modelValue"])]),_:1}),e(k,{label:"邮箱"},{default:o(()=>[e(D,{modelValue:c.email,"onUpdate:modelValue":t[10]||(t[10]=s=>c.email=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(T,{modelValue:g.value,"onUpdate:modelValue":t[14]||(t[14]=s=>g.value=s),title:"更换头像",width:"400px"},{footer:o(()=>[e(u,{onClick:t[13]||(t[13]=s=>g.value=!1)},{default:o(()=>[...t[30]||(t[30]=[d("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:ot},{default:o(()=>[...t[31]||(t[31]=[d("保存",-1)])]),_:1})]),default:o(()=>[l("div",ce,[e(_t,{class:"avatar-uploader",action:"#","show-file-list":!1,"before-upload":lt},{default:o(()=>[A.value?(m(),_("img",{key:0,src:A.value,class:"avatar"},null,8,me)):(m(),kt(y,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[e(mt)]),_:1}))]),_:1}),t[29]||(t[29]=l("p",{class:"upload-tip"},"点击上传头像，支持 JPG、PNG 格式",-1))])]),_:1},8,["modelValue"])])}}},ke=pt(_e,[["__scopeId","data-v-39503824"]]);export{ke as default};
